"""Constants for the LiTime BMS BLE integration."""

from __future__ import annotations

DOMAIN = "litime_bms_ble"

# BLE UUIDs
SERVICE_UUID = "0000ffe0-0000-1000-8000-00805f9b34fb"
NOTIFY_CHAR_UUID = "0000ffe1-0000-1000-8000-00805f9b34fb"
WRITE_CHAR_UUID = "0000ffe2-0000-1000-8000-00805f9b34fb"

# BLE device name prefixes for discovery
DEVICE_NAME_PREFIXES = ("LT-", "L-")

# Command IDs (8-byte frame: {0x00, 0x00, 0x04, 0x01, CMD, 0x55, 0xAA, CHECKSUM})
CMD_DISCONNECT = 0x02
CMD_CHARGE_ON = 0x0A
CMD_CHARGE_OFF = 0x0B
CMD_DISCHARGE_ON = 0x0C
CMD_DISCHARGE_OFF = 0x0D
CMD_SERIAL_NUMBER = 0x10
CMD_QUERY_STATUS = 0x13
CMD_FIRMWARE_VERSION = 0x16
CMD_GET_SOH_SOC = 0x41
CMD_GET_NOMINAL_CAPACITY = 0x43

# Maximum number of cells
MAX_CELLS = 16

# Minimum response length for status query
MIN_RESPONSE_LENGTH = 104

# Protection state flags
PROTECTION_OVERCHARGE = 0x00000004
PROTECTION_OVERDISCHARGE = 0x00000020
PROTECTION_CHARGE_OVERCURRENT = 0x00000040
PROTECTION_DISCHARGE_OVERCURRENT = 0x00000080
PROTECTION_HIGH_TEMP_1 = 0x00000100
PROTECTION_HIGH_TEMP_2 = 0x00000200
PROTECTION_LOW_TEMP_1 = 0x00000400
PROTECTION_LOW_TEMP_2 = 0x00000800
PROTECTION_SHORT_CIRCUIT = 0x00004000

PROTECTION_FLAGS = {
    PROTECTION_OVERCHARGE: "Overcharge",
    PROTECTION_OVERDISCHARGE: "Over-discharge",
    PROTECTION_CHARGE_OVERCURRENT: "Charge overcurrent",
    PROTECTION_DISCHARGE_OVERCURRENT: "Discharge overcurrent",
    PROTECTION_HIGH_TEMP_1: "High temp 1",
    PROTECTION_HIGH_TEMP_2: "High temp 2",
    PROTECTION_LOW_TEMP_1: "Low temp 1",
    PROTECTION_LOW_TEMP_2: "Low temp 2",
    PROTECTION_SHORT_CIRCUIT: "Short circuit",
}

# Battery state values
BATTERY_STATE_DISCHARGING = 0x0000
BATTERY_STATE_CHARGING = 0x0001
BATTERY_STATE_CHARGE_DISABLED = 0x0004

# Update interval in seconds (matches ESPHome YAML interval of 30s)
DEFAULT_UPDATE_INTERVAL = 30

# Max missed updates before marking offline
MAX_MISSED_UPDATES = 5

# Config keys
CONF_DEVICE_ADDRESS = "device_address"
CONF_DEVICE_NAME = "device_name"
